
<style>
body {
    /*background-image: url('https://static.pexels.com/photos/34950/pexels-photo.jpg');*/
    /*background-size:cover;*/
}
.bubble {
    float: left;
    border-radius: 16px;
    overflow: hidden;
    margin: 2px
}

.bubble.me {
    float: right;
}

.bubble.text {
    border: 1px solid;

    /*white-space: pre;*/
    padding:4px 14px 4px 14px;
    margin: 4px;
    font-size: 120%;
    max-width:350px;
    border-color:lightgray;
    background-color:lightgray;
    color:black;
}

.bubble.text.me {
    border-color:#1085f9;
    background-color:#1085f9;
    color:white;
}
.bubble.emoji {
    font-size: 400%;
    border:none;
    background-color:transparent !important;
    margin-top: 0px; margin-bottom: 0px;
    padding-top: 0px; padding-bottom: 0px;
}

.bubble a {
    color:inherit;
}

.bubble img {
    max-height:350px;
    max-width:350px;
}

.bubble video {
    max-height:350px;
    max-width:350px;
}

.time-tag {
    clear: both;
    font-size:70%;
    color:gray;
    padding-left: 7px;
    padding-right: 7px;
    margin-top:   -2px;
    margin-bottom: 4px;
}
.time-tag.me {
    text-align: right;
}
</style>

<div ng-cloak class="container">

    <div id="chat" class="row" style="position:fixed;top:0px;right:0px;left:0px;bottom:90px;overflow-y: scroll;-webkit-overflow-scrolling: touch;" >
        <div class="col-xs-12" style="height:400px;"></div>
        <div class="col-xs-12" ng-repeat="msg in chatCtrl.messages track by msg._id">

            <div class="bubble {{::msg.type}}" ng-class="::{ me: msg.me, emoji: chatCtrl.isAllEmoji(msg.text) }">
                <span ng-switch="::msg.type">
                    <span ng-switch-when="image">
                        <a ng-href="{{::msg.text}}" target="pic">
                            <img ng-src="{{::msg.text}}">
                        </a>
                    </span>
                    <span ng-switch-when="video">
                        <video controls>
                            <source ng-src="{{::msg.text}}">
                        </video>
                    </span>
                    <span ng-switch-default ng-bind-html="::chatCtrl.toHtml(msg.text)"></span>
                </span>

            </div>

            <div ng-if="msg.me!=chatCtrl.messages[$index+1].me || (msg.date|moment:'calendar')!=(chatCtrl.messages[$index+1].date|moment:'calendar')" class="time-tag"  ng-class="::{ me: msg.me }">{{::msg.date|moment:'calendar'}}</div>
        </div>
    </div>

    <div id="input" class="row" style="position:fixed;right:0px;left:0px;bottom:2px;">
        <div class="col-xs-12">
            <form ng-submit="chatCtrl.post(text); text='';" autocomplete="off">
            <div class="input-group dropup" style="position:relative">
                <span class="input-group-addon" style="padding:0px;">
                    <div class="btn-group-vertical btn-group-sm">
                        <button class="btn btn-link" style="font-size:125%" ng-click="chatCtrl.selectPhoto()">
                            <i class="fa fa-fw fa-camera"></i>
                        </button>

                        <button class="btn btn-link" style="font-size:125%" data-toggle="dropdown">
                            <i class="fa fa-fw fa-bars"></i>
                        </button>

                        <ul class="dropdown-menu">
                            <li><a href="#" ng-click="chatCtrl.disconnect()"><i class="fa fa-user-times" aria-hidden="true"></i> Disconnect</a></li>
                            <li role="separator" class="divider"></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#" ng-click="chatCtrl.deleteAll()"><i class="fa fa-times"></i> Delete all</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#" ng-click="chatCtrl.load()"><i class="fa fa-refresh" ng-class="{'fa-spin':chatCtrl.loading}"></i> Refresh</a></li>
                        </ul>
                    </div>
                </span>

                <textarea autocomplete="off" rows="3" style="padding:2px"  ng-model="text" class="form-control input-lg" onfocus="window.keepFocus=null" onblur="if(window.keepFocus) { event.target.focus(); } window.keepFocus=null;" placeholder="Last refresh {{(date|moment:'format':'H:mm:ss')||'never'}}"></textarea>

                <span class="input-group-addon" style="padding:0px;">
                    <button class="btn btn-link" style="font-size:200%;padding-left:6px;padding-right:6px" onmousedown="window.keepFocus=true" ng-click="chatCtrl.post(text); text='';">
                        <i ng-hide="chatCtrl.loading" class="fa fa-fw fa-arrow-circle-up" ></i>
                        <i ng-show="chatCtrl.loading" class="fa fa-fw fa-refresh fa-spin"></i>
                    </button>
                </span>
            </div><!-- /input-group -->

            </form>
        </div><!-- /.col-lg-6 -->
    </div>
</div>
